<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./public/lib/bootstrap-5.3.5-dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <title>Inscripción - Escuela San Sebastián</title>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .form-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .navbar-custom {
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
        <div class="container">
            <a class="navbar-brand fw-bold" href="inicio.html">
                <i class="bi bi-mortarboard-fill me-2"></i>
                Escuela San Sebastián
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="inicio.html">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="mostrar.html">Estudiantes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="inscripcion.html">Inscripción</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-5" style="margin-top: 80px;">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="form-container p-5">
                    <div class="text-center mb-4">
                        <i class="bi bi-pencil-square text-primary" style="font-size: 3rem;"></i>
                        <h2 class="mt-3 text-primary">Formulario de Inscripción</h2>
                        <p class="text-muted">Completa todos los campos para procesar tu solicitud</p>
                    </div>

                    <form id="inscripcionForm">
                        <!-- Información del Estudiante -->
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0"><i class="bi bi-person-fill me-2"></i>Información del Estudiante</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="nombres" class="form-label">Nombres *</label>
                                        <input type="text" class="form-control" id="nombres" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="apellidos" class="form-label">Apellidos *</label>
                                        <input type="text" class="form-control" id="apellidos" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="fechaNacimiento" class="form-label">Fecha de Nacimiento *</label>
                                        <input type="date" class="form-control" id="fechaNacimiento" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="grado" class="form-label">Grado a Inscribir *</label>
                                        <select class="form-select" id="grado" required>
                                            <option value="">Selecciona un grado</option>
                                            <option value="preescolar">Preescolar</option>
                                            <option value="1ro">1° Primaria</option>
                                            <option value="2do">2° Primaria</option>
                                            <option value="3ro">3° Primaria</option>
                                            <option value="4to">4° Primaria</option>
                                            <option value="5to">5° Primaria</option>
                                            <option value="6to">6° Primaria</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Información de los Padres -->
                        <div class="card mb-4">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="bi bi-people-fill me-2"></i>Información de los Padres/Tutores</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="nombrePadre" class="form-label">Nombre del Padre/Tutor *</label>
                                        <input type="text" class="form-control" id="nombrePadre" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="telefonoPadre" class="form-label">Teléfono *</label>
                                        <input type="tel" class="form-control" id="telefonoPadre" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="emailPadre" class="form-label">Email *</label>
                                        <input type="email" class="form-control" id="emailPadre" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="ocupacion" class="form-label">Ocupación</label>
                                        <input type="text" class="form-control" id="ocupacion">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="direccion" class="form-label">Dirección *</label>
                                    <textarea class="form-control" id="direccion" rows="2" required></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Información Adicional -->
                        <div class="card mb-4">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="mb-0"><i class="bi bi-info-circle-fill me-2"></i>Información Adicional</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="comentarios" class="form-label">Comentarios o Necesidades Especiales</label>
                                    <textarea class="form-control" id="comentarios" rows="3" placeholder="Describe cualquier necesidad especial o comentario adicional..."></textarea>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="terminos" required>
                                    <label class="form-check-label" for="terminos">
                                        Acepto los términos y condiciones de la escuela *
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg px-5">
                                <i class="bi bi-send-fill me-2"></i>
                                Enviar Solicitud
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="bi bi-mortarboard-fill me-2"></i>Escuela San Sebastián</h5>
                    <p class="mb-0">Formando líderes del mañana</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">
                        <i class="bi bi-telephone-fill me-2"></i>(123) 456-7890
                        <br>
                        <i class="bi bi-envelope-fill me-2"></i>info@sansebastian.edu
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="./public/lib/bootstrap-5.3.5-dist/js/bootstrap.bundle.min.js"></script>
    <script src="./public/js/funciones.js"></script>
    <script>
        // Manejo avanzado del formulario con validaciones
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('inscripcionForm');
            
            // Validación en tiempo real
            setupRealTimeValidation();
            
            // Manejar envío del formulario
            form.addEventListener('submit', handleFormSubmit);
        });
        
        // Configurar validación en tiempo real
        function setupRealTimeValidation() {
            const nombresInput = document.getElementById('nombres');
            const apellidosInput = document.getElementById('apellidos');
            const emailInput = document.getElementById('emailPadre');
            const telefonoInput = document.getElementById('telefonoPadre');
            const fechaInput = document.getElementById('fechaNacimiento');
            
            // Validar nombres
            nombresInput.addEventListener('input', function() {
                validateField(this, ValidationUtils.isValidName(this.value), 'Solo se permiten letras y espacios');
            });
            
            // Validar apellidos
            apellidosInput.addEventListener('input', function() {
                validateField(this, ValidationUtils.isValidName(this.value), 'Solo se permiten letras y espacios');
            });
            
            // Validar email
            emailInput.addEventListener('input', function() {
                validateField(this, ValidationUtils.isValidEmail(this.value), 'Formato de email inválido');
            });
            
            // Validar teléfono
            telefonoInput.addEventListener('input', function() {
                validateField(this, ValidationUtils.isValidPhone(this.value), 'Formato de teléfono inválido');
            });
            
            // Validar fecha de nacimiento
            fechaInput.addEventListener('input', function() {
                validateField(this, ValidationUtils.isValidBirthDate(this.value), 'La edad debe estar entre 3 y 18 años');
            });
        }
        
        // Validar campo individual
        function validateField(field, isValid, errorMessage) {
            const feedbackDiv = field.parentNode.querySelector('.invalid-feedback') || 
                              document.createElement('div');
            
            if (!field.parentNode.querySelector('.invalid-feedback')) {
                feedbackDiv.className = 'invalid-feedback';
                field.parentNode.appendChild(feedbackDiv);
            }
            
            if (isValid) {
                field.classList.remove('is-invalid');
                field.classList.add('is-valid');
                feedbackDiv.textContent = '';
            } else {
                field.classList.remove('is-valid');
                field.classList.add('is-invalid');
                feedbackDiv.textContent = errorMessage;
            }
        }
        
        // Manejar envío del formulario
        function handleFormSubmit(e) {
            e.preventDefault();
            
            // Validar todos los campos
            const isFormValid = validateForm();
            
            if (!isFormValid) {
                notificationSystem.error('Por favor corrige los errores en el formulario');
                return;
            }
            
            // Crear objeto de estudiante
            const studentData = {
                id: ValidationUtils.generateUniqueId(),
                nombres: ValidationUtils.sanitizeInput(document.getElementById('nombres').value),
                apellidos: ValidationUtils.sanitizeInput(document.getElementById('apellidos').value),
                fechaNacimiento: document.getElementById('fechaNacimiento').value,
                grado: document.getElementById('grado').value,
                telefono: document.getElementById('telefonoPadre').value,
                email: document.getElementById('emailPadre').value,
                direccion: ValidationUtils.sanitizeInput(document.getElementById('direccion').value),
                estado: 'activo',
                fechaInscripcion: new Date().toISOString().split('T')[0],
                notas: { matematicas: 0, español: 0, ciencias: 0, ingles: 0 },
                observaciones: ValidationUtils.sanitizeInput(document.getElementById('comentarios').value || '')
            };
            
            // Guardar en el sistema
            const currentData = dataManager.getData();
            currentData.push(studentData);
            
            if (dataManager.saveData(currentData)) {
                // Mostrar animación de éxito
                showSuccessAnimation();
                
                // Resetear formulario
                setTimeout(() => {
                    document.getElementById('inscripcionForm').reset();
                    removeValidationClasses();
                    
                    // Preguntar si desea agregar otro estudiante
                    if (confirm('Estudiante registrado exitosamente. ¿Deseas registrar otro estudiante?')) {
                        document.getElementById('nombres').focus();
                    } else {
                        window.location.href = 'mostrar.html';
                    }
                }, 3000);
            } else {
                notificationSystem.error('Error al guardar los datos. Inténtalo de nuevo.');
            }
        }
        
        // Validar formulario completo
        function validateForm() {
            const nombres = document.getElementById('nombres').value;
            const apellidos = document.getElementById('apellidos').value;
            const email = document.getElementById('emailPadre').value;
            const telefono = document.getElementById('telefonoPadre').value;
            const fecha = document.getElementById('fechaNacimiento').value;
            const grado = document.getElementById('grado').value;
            const direccion = document.getElementById('direccion').value;
            const terminos = document.getElementById('terminos').checked;
            
            let isValid = true;
            
            if (!ValidationUtils.isValidName(nombres)) {
                validateField(document.getElementById('nombres'), false, 'Nombres requeridos');
                isValid = false;
            }
            
            if (!ValidationUtils.isValidName(apellidos)) {
                validateField(document.getElementById('apellidos'), false, 'Apellidos requeridos');
                isValid = false;
            }
            
            if (!ValidationUtils.isValidEmail(email)) {
                validateField(document.getElementById('emailPadre'), false, 'Email válido requerido');
                isValid = false;
            }
            
            if (!ValidationUtils.isValidPhone(telefono)) {
                validateField(document.getElementById('telefonoPadre'), false, 'Teléfono válido requerido');
                isValid = false;
            }
            
            if (!ValidationUtils.isValidBirthDate(fecha)) {
                validateField(document.getElementById('fechaNacimiento'), false, 'Fecha de nacimiento válida requerida');
                isValid = false;
            }
            
            if (!grado) {
                document.getElementById('grado').classList.add('is-invalid');
                isValid = false;
            }
            
            if (!direccion.trim()) {
                document.getElementById('direccion').classList.add('is-invalid');
                isValid = false;
            }
            
            if (!terminos) {
                document.getElementById('terminos').classList.add('is-invalid');
                isValid = false;
            }
            
            return isValid;
        }
        
        // Mostrar animación de éxito
        function showSuccessAnimation() {
            const submitBtn = document.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            // Cambiar botón
            submitBtn.innerHTML = '<i class="bi bi-check-circle-fill me-2"></i>¡Registrado!';
            submitBtn.classList.remove('btn-primary');
            submitBtn.classList.add('btn-success');
            submitBtn.disabled = true;
            
            // Crear efecto de partículas
            AnimationEffects.createParticles(submitBtn.parentNode, '#28a745');
            
            // Mostrar notificación
            notificationSystem.success('¡Estudiante registrado exitosamente! 🎉', 4000);
            
            // Restaurar botón después de 3 segundos
            setTimeout(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.classList.remove('btn-success');
                submitBtn.classList.add('btn-primary');
                submitBtn.disabled = false;
            }, 3000);
        }
        
        // Remover clases de validación
        function removeValidationClasses() {
            const inputs = document.querySelectorAll('.form-control, .form-select');
            inputs.forEach(input => {
                input.classList.remove('is-valid', 'is-invalid');
            });
            
            const feedbacks = document.querySelectorAll('.invalid-feedback');
            feedbacks.forEach(feedback => feedback.remove());
        }
    </script>
</body>
</html>